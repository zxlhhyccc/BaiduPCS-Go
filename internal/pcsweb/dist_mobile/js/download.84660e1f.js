(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["download"],{3971:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"route-download"},[a("header",{staticClass:"mv-header"},[a("div",{staticClass:"h-item",class:{focus:0===t.tabIndex},on:{click:function(e){t.tabIndex=0}}},[a("span",[t._v("下载列表")])]),a("div",{staticClass:"h-item",class:{focus:1===t.tabIndex},on:{click:function(e){t.tabIndex=1}}},[a("span",[t._v("上传列表")])]),a("div",{staticClass:"h-item",class:{focus:2===t.tabIndex},on:{click:function(e){t.tabIndex=2}}},[a("span",[t._v("离线下载")])])]),a("div",{directives:[{name:"show",rawName:"v-show",value:0===t.tabIndex,expression:"tabIndex === 0"}],staticClass:"panel panel-download"},[t.globals.downloading.length||t.globals.pending_download.length?a("div",{staticClass:"row-cancel"},[a("button",{staticClass:"mv-btn btn-danger",attrs:{type:"button"},on:{click:t.cancelAllDownload}},[t._v("全部取消")])]):t._e(),a("div",{staticClass:"items-list"},t._l(t.globals.downloading,function(e){return a("div",{staticClass:"item item-ing"},[a("div",{staticClass:"i-name"},[t._v(t._s(e.name)+"【"+t._s(e.total_size)+"】")]),a("div",{staticClass:"i-progress"},[a("mt-progress",{attrs:{value:e.percent}})],1),a("div",{staticClass:"i-info"},[a("div",{staticClass:"ii-cell"},[a("span",[t._v("速度")]),a("span",[t._v(t._s(e.speed)+"/s")])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已经下载")]),a("span",[t._v(t._s(e.download_size))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已用时间")]),a("span",[t._v(t._s(e.time_used))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("预计还需")]),a("span",[t._v(t._s(e.time_left))])])]),a("div",{staticClass:"i-actions"},[a("button",{staticClass:"mv-btn",attrs:{type:"button"},on:{click:function(a){t.switchDownloadStatus(e)}}},[t._v(t._s(e.is_pause?"继续下载":"暂停"))]),a("button",{staticClass:"mv-btn",attrs:{type:"button"},on:{click:function(a){t.cancelTask(e)}}},[t._v("取消")])])])})),a("div",{staticClass:"items-list"},t._l(t.globals.pending_download,function(e){return a("div",{staticClass:"item item-ing"},[a("div",{staticClass:"i-name"},[t._v(t._s(e.name)+"【等待下载...】")]),a("div",{staticClass:"i-info"},[a("div",{staticClass:"ii-cell"},[a("span",[t._v("速度")]),a("span",[t._v(t._s(e.speed)+"/s")])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已经下载")]),a("span",[t._v(t._s(e.download_size))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已用时间")]),a("span",[t._v(t._s(e.time_used))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("预计还需")]),a("span",[t._v(t._s(e.time_left))])])])])})),a("div",{staticClass:"items-list"},t._l(t.globals.downloaded,function(e){return a("div",{staticClass:"item item-done"},[a("div",{staticClass:"i-name"},[t._v(t._s(e.name)+"【已完成】")]),a("div",{staticClass:"i-info"},[a("div",{staticClass:"ii-cell"},[a("span",[t._v("平均速度")]),a("span",[t._v(t._s(e.avg_speed)+"/s")])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已用时间")]),a("span",[t._v(t._s(e.time_used))])])])])}))]),a("div",{directives:[{name:"show",rawName:"v-show",value:1===t.tabIndex,expression:"tabIndex === 1"}],staticClass:"panel panel-upload"},[t.globals.uploading.length||t.globals.pending_upload.length?a("div",{staticClass:"row-cancel"},[a("button",{staticClass:"mv-btn btn-danger",attrs:{type:"button"},on:{click:t.cancelAllUpload}},[t._v("全部取消")])]):t._e(),a("div",{staticClass:"items-list"},t._l(t.globals.uploading,function(e){return a("div",{staticClass:"item item-ing"},[a("div",{staticClass:"i-name"},[t._v(t._s(e.name)+"【"+t._s(e.total_size)+"】")]),a("div",{staticClass:"i-progress"},[a("mt-progress",{attrs:{value:e.percent}})],1),a("div",{staticClass:"i-info"},[a("div",{staticClass:"ii-cell"},[a("span",[t._v("速度")]),a("span",[t._v(t._s(e.speed)+"/s")])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已经上传")]),a("span",[t._v(t._s(e.download_size))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已用时间")]),a("span",[t._v(t._s(e.time_used))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("预计还需")]),a("span",[t._v(t._s(e.time_left))])])])])})),a("div",{staticClass:"items-list"},t._l(t.globals.pending_upload,function(e){return a("div",{staticClass:"item item-ing"},[a("div",{staticClass:"i-name"},[t._v(t._s(e.name)+"【等待上传...】")]),a("div",{staticClass:"i-info"},[a("div",{staticClass:"ii-cell"},[a("span",[t._v("速度")]),a("span",[t._v(t._s(e.speed)+"/s")])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已经上传")]),a("span",[t._v(t._s(e.download_size))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已用时间")]),a("span",[t._v(t._s(e.time_used))])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("预计还需")]),a("span",[t._v(t._s(e.time_left))])])])])})),a("div",{staticClass:"items-list"},t._l(t.globals.uploaded,function(e){return a("div",{staticClass:"item item-done"},[a("div",{staticClass:"i-name"},[t._v(t._s(e.name)+"【"+t._s(e.total_size)+"】")]),a("div",{staticClass:"i-info"},[a("div",{staticClass:"ii-cell"},[a("span",[t._v("平均速度")]),a("span",[t._v(t._s(e.avg_speed)+"/s")])]),a("div",{staticClass:"ii-cell"},[a("span",[t._v("已用时间")]),a("span",[t._v(t._s(e.time_used))])])])])}))])])},n=[];function i(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}function c(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function o(t){return i(t)||c(t)||l()}a("96cf");var r=a("1da1"),d=a("be94"),u=(a("cadf"),a("551c"),a("097d"),a("db49")),v=a("c276"),p=a("2f62"),_=a("76a0"),m={name:"v-download",data:function(){return{tabIndex:0,select_menu_name:"1-1",base_url:u["a"].base_url,ws_url:u["a"].ws_url,modalDetailFlag:!1,offline_downloaded:[],offline_downloading:[]}},computed:Object(d["a"])({},Object(p["c"])(["globals","websocket"])),methods:Object(d["a"])({},Object(p["b"])(["initWS"]),{initWebSocket:function(){null===this.websocket&&this.initWS()},switchDownloadStatus:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e){var a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return _["Indicator"].open(),a=e.is_pause?"resume":"pause",t.next=4,$axios.get("download?method=".concat(a,"&id=").concat(e.LastID)).catch(this.error);case 4:s=t.sent,_["Indicator"].close(),Object(_["Toast"])(0===s.data.code?"操作成功":s.data.msg);case 7:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),cancelTask:function(t){var e=this;_["MessageBox"].confirm("删除任务后无法恢复, 确定吗?").then(Object(r["a"])(regeneratorRuntime.mark(function a(){var s;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return _["Indicator"].open(),a.next=3,$axios.get("download?method=cancel&id=".concat(t.LastID)).catch(e.error);case 3:s=a.sent,_["Indicator"].close(),Object(_["Toast"])(0===s.data.code?"操作成功":s.data.msg);case 6:case"end":return a.stop()}},a,this)}))).catch(function(){})},deleteTask:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(e){var a,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return a="delete",0!==e.status&&(a="cancel"),t.next=4,$axios.get("offline_download?method=".concat(a,"&id=").concat(e.taskid)).catch(this.error);case 4:s=t.sent,0===s.data.code?(this.$Message.success("删除成功"),this.getOfflineTask()):this.$Message.error({content:s.data.msg,duration:10,closable:!0});case 6:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),getOfflineTask:function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(){var e,a,s,n,i,c,l,o=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,$axios.get("offline_download?method=list").catch(this.error);case 2:if(e=t.sent,0===e.data.code){for(a=e.data.data,s=[],n=[],i=0;i<a.length;i++)c=a[i],0===c.Status?s.push({taskid:c.TaskID,taskname:c.TaskName,status:c.Status,status_text:c.StatusText,file_size:v["a"].bytesToSize(c.FileSize),finished_size:v["a"].bytesToSize(c.FinishedSize),ftime:v["a"].formatDateTime(1e3*c.FinishTime),path:c.SavePath,url:c.SourceURL,type:c.OdType}):(l=(1*c.FinishedSize/(1*c.FileSize)*100).toFixed(2),n.push({taskid:c.TaskID,taskname:c.TaskName,status:c.Status,status_text:c.StatusText,file_size:v["a"].bytesToSize(c.FileSize),finished_size:v["a"].bytesToSize(c.FinishedSize),percent:1*l,stime:v["a"].formatDateTime(1e3*c.StartTime),path:c.SavePath,url:c.SourceURL,type:c.OdType}));this.offline_downloaded=s,this.offline_downloading=n,n.length>0&&setTimeout(function(){return o.getOfflineTask()},1e3)}else this.$Message.error({content:e.data.msg,duration:10,closable:!0});case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),cancelAllDownload:function(){var t=this;_["MessageBox"].confirm("删除任务后无法恢复, 确定吗?").then(Object(r["a"])(regeneratorRuntime.mark(function e(){var a,s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:_["Indicator"].open(),a=o(t.globals.downloading.map(function(t){return t.LastID})).concat(o(t.globals.pending_download.map(function(t){return t.LastID}))),n=0;case 3:if(!(n<a.length)){e.next=15;break}case 4:return e.next=6,v["a"].sleep();case 6:return e.next=8,$axios.get("download?method=cancel&id=".concat(a[n])).catch(t.error);case 8:s=e.sent;case 9:if(0!==s.data.code){e.next=4;break}case 10:return e.next=12,v["a"].sleep();case 12:n++,e.next=3;break;case 15:_["Indicator"].close();case 16:case"end":return e.stop()}},e,this)}))).catch(function(){})},cancelAllUpload:function(){var t=this;_["MessageBox"].confirm("删除任务后无法恢复, 确定吗?").then(Object(r["a"])(regeneratorRuntime.mark(function e(){var a,s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:_["Indicator"].open(),a=o(t.globals.uploading.map(function(t){return t.LastID})).concat(o(t.globals.pending_upload.map(function(t){return t.LastID}))),n=0;case 3:if(!(n<a.length)){e.next=15;break}case 4:return e.next=6,v["a"].sleep();case 6:return e.next=8,$axios.get("upload?method=cancel&id=".concat(a[n])).catch(t.error);case 8:s=e.sent;case 9:if(0!==s.data.code){e.next=4;break}case 10:return e.next=12,v["a"].sleep();case 12:n++,e.next=3;break;case 15:_["Indicator"].close();case 16:case"end":return e.stop()}},e,this)}))).catch(function(){})}}),created:function(){this.initWebSocket()}},f=m,h=a("2877"),g=Object(h["a"])(f,s,n,!1,null,null,null);g.options.__file="Download.vue";e["default"]=g.exports}}]);
//# sourceMappingURL=download.84660e1f.js.map